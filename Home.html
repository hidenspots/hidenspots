<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DWS0BB3H70"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DWS0BB3H70');
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hiden Spots ‚Äî Search Hidden Places</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
/* === ALL YOUR ORIGINAL STYLES (unchanged) === */
:root{
  --bg:#0c0f18; --panel:#121624; --glass:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12); --muted:rgba(255,255,255,.78);
  --gold:#FFD88D; --amber:#FFB347; --teal:#19547b;
}
*{box-sizing:border-box} html,body{height:100%} body{
  margin:0; background:var(--bg); color:#fff; font-family:'Playfair Display',serif;
}

/* Header */
.header{
  position:sticky; top:0; z-index:40;
  backdrop-filter:blur(12px);
  background:linear-gradient(180deg,rgba(12,15,24,.85),rgba(12,15,24,.55));
  border-bottom:1px solid var(--border);
  padding:12px 18px;
  display:flex; align-items:center; gap:14px;
}
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:#fff}
.brand svg{width:30px;height:30px}
.brand span{letter-spacing:3px}

/* Search bar */
.searchbar{
  flex:1; display:flex; align-items:center; gap:10px;
  background:var(--glass); border:1px solid var(--border);
  border-radius:40px; padding:10px 14px 10px 14px;
}
.tag {
  padding: 4px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.1);
  border: 1px solid var(--border);
  font-size: 12px;
  opacity: .9;
}
.searchbar input{
  flex:1; background:transparent; border:0; outline:none; color:#fff;
  font-size:16px; letter-spacing:.3px;
}
.icon-btn{background:transparent;border:0;color:var(--muted);cursor:pointer}
.icon-btn:hover{color:var(--gold)}
.kbd{font-size:12px;border:1px solid var(--border);padding:2px 6px;border-radius:6px;color:var(--muted)}

/* Suggestions */
.suggest{
  position:absolute; left:50%; transform:translateX(-50%);
  top:64px; width:min(800px,92vw); background:#0f1423; border:1px solid var(--border);
  border-radius:14px; overflow:hidden; display:none; z-index:50;
}
.suggest.active{display:block}
.sgroup{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06)}
.sgroup h4{margin:6px 6px 8px; font-size:13px; letter-spacing:1px; text-transform:uppercase; opacity:.8}
.sitem{display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; cursor:pointer}
.sitem:hover,.sitem.active{background:rgba(255,255,255,.06)}
.sitem small{opacity:.7}
.nav-bar{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: env(safe-area-inset-bottom, 0px);
  margin-bottom: 12px;

  background: rgba(255,255,255,.06);
  backdrop-filter: blur(25px);
  border-radius: 60px;
  padding: 14px 26px;
  border: 1px solid rgba(255,255,255,.14);

  display: flex;
  gap: 2.2rem;

  box-shadow: 0 10px 30px rgba(0,0,0,.35);
  z-index: 999;
}
  .nav-icon{color:rgba(255,255,255,.7);transition:.4s}
  .nav-icon:hover{color:var(--gold);transform:translateY(-2px);filter:drop-shadow(0 0 10px rgba(255,216,155,.6))}
  .nav-icon svg{width:24px;height:24px;stroke:currentColor;stroke-width:1.8;fill:none}
/* Chips row */
.tools{
  display:flex; gap:10px; padding:10px 18px 12px;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,rgba(12,15,24,.65),rgba(12,15,24,.2));
  overflow-x:auto; white-space:nowrap; scrollbar-width:none;
}
.tools::-webkit-scrollbar{display:none}
.chip{
  display:inline-flex; align-items:center; justify-content:center;
  padding:8px 12px; border:1px solid var(--border);
  border-radius:999px; background:var(--glass); cursor:pointer; font-size:14px;
  flex:0 0 auto;
}
.chip.active{background:linear-gradient(90deg,var(--gold),var(--teal)); color:#0c0f18; font-weight:600; border-color:transparent}
.chip.clear{background:transparent;border-style:dashed}

/* Layout */
.main{display:grid; grid-template-columns: 1.2fr 1fr; gap:14px; height:calc(100vh - 132px)}
@media(max-width:980px){ .main{grid-template-columns:1fr; height:auto} }

/* Left: results list */
.list{overflow:auto; padding:14px 18px 120px;}

/* Result cards */
.card{background:var(--panel); border:1px solid var(--border); border-radius:16px; overflow:hidden; margin-bottom:14px; box-shadow:0 12px 26px rgba(0,0,0,.25)}
.media{position:relative; overflow:hidden}
.media img{width:100%; height:100%; object-fit:cover; transition:transform .8s, filter .8s}
.card:hover .media img{transform:scale(1.05); filter:brightness(.9)}
.badge{position:absolute; left:10px; bottom:10px; background:rgba(0,0,0,.55); border:1px solid var(--border); padding:4px 10px; border-radius:999px; color:var(--gold); font-size:12px}

/* Detailed card */
.card.detailed .media{height:200px}
.info{padding:12px 14px 6px; border-top:1px solid rgba(255,255,255,.05)}
.title{color:var(--gold); font-size:18px; margin:0 0 4px}
.sub{opacity:.85; margin:0 0 4px}
.meta{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 14px; border-top:1px solid rgba(255,255,255,.05)}
.mleft{display:flex; align-items:center; gap:8px}
.avatar{width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid var(--border)}
.username{opacity:.9; font-size:14px}
.mright{display:flex; align-items:center; gap:6px}
.follow{padding:4px 10px; border-radius:999px; border:1px solid var(--border); background:var(--glass); color:#fff; cursor:pointer}
.follow:hover{background:linear-gradient(90deg,var(--gold),var(--amber)); color:#0c0f18; border-color:transparent}
.menu{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--glass);border:1px solid var(--border);cursor:pointer}
.menu:after{content:"‚ãØ"; font-size:18px}
.story{padding:0 14px 14px}
.story p{
  margin:6px 0 0; font-size:15px; opacity:.9; line-height:1.5;
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
}
.story a{color:var(--gold); text-decoration:none; font-size:14px}
.story a:hover{text-decoration:underline}

/* Compact card */
.card.compact .media{height:160px}
.card.compact .info{padding:10px 12px}
.card.compact .title{font-size:16px;margin:0}
.card.compact .sub{display:none}
.card.compact .meta, .card.compact .story{display:none}

/* NEW: Profile result card (Instagram-style) */
.card.profile{
  display:flex;
  align-items:center;
  gap:20px;
  padding:20px;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  margin-bottom:20px;
  box-shadow:0 12px 28px rgba(0,0,0,.3);
  cursor:pointer;
}
.card.profile:hover{
  transform:translateY(-4px);
  box-shadow:0 16px 36px rgba(0,0,0,.4);
}
.card.profile .avatar{
  width:90px;
  height:90px;
  border-radius:50%;
  object-fit:cover;
  border:4px solid var(--gold);
  flex-shrink:0;
}
.card.profile .info{flex:1}
.card.profile .title{
  font-size:22px;
  margin:0 0 8px 0;
  color:var(--gold);
}
.card.profile .bio{
  opacity:.85;
  font-size:15px;
  margin:0 0 12px 0;
}
.card.profile .stats{
  display:flex;
  gap:30px;
  font-size:15px;
  opacity:.9;
}
.card.profile .stat-item{
  text-align:center;
}
.card.profile .number{
  font-weight:600;
  font-size:18px;
  display:block;
}
.card.profile .label{
  font-size:13px;
  opacity:.8;
}
.card.profile .follow{
  margin-left:auto;
  padding:12px 28px;
  font-size:16px;
  font-weight:600;
}

/* Map & rest unchanged */
.map-wrap{position:relative; padding:10px 10px 80px;}
.map{
  position:sticky; top:96px; height:calc(100vh - 180px);
  border:1px solid var(--border); border-radius:16px; overflow:hidden;
}
@media(max-width:980px){ .map{position:relative; top:auto; height:320px} }

.toast{
  position:absolute; left:50%; transform:translateX(-50%); bottom:14px;
  background:rgba(0,0,0,.65); border:1px solid var(--border); border-radius:999px;
  padding:8px 14px; display:none; align-items:center; gap:8px; z-index:5;
}
.toast.active{display:flex}
.toast button{background:linear-gradient(90deg,var(--gold),var(--amber)); color:#0c0f18; border:0; border-radius:999px; padding:6px 12px; cursor:pointer}

/* Filters, powers, skeleton unchanged */
.filters{position:fixed; right:18px; top:88px; z-index:45;}
.filter-btn{padding:8px 14px; border-radius:999px; border:1px solid var(--border); background:var(--glass); cursor:pointer}
.filter-btn:hover{background:linear-gradient(90deg,var(--gold),var(--amber)); color:#0c0f18; border-color:transparent}
.drawer{
  position:fixed; right:18px; top:140px; width:320px; max-width:92vw;
  background:#0f1423; border:1px solid var(--border); border-radius:16px;
  box-shadow:0 16px 40px rgba(0,0,0,.45); display:none; z-index:60;
}
.drawer.active{display:block}
.powers{display:flex; gap:8px; flex-wrap:wrap; padding:8px 18px 0}
.skel{
  height:120px; border-radius:12px; background:
  linear-gradient(90deg, rgba(255,255,255,.05) 25%, rgba(255,255,255,.12) 37%, rgba(255,255,255,.05) 63%);
  background-size:400% 100%; animation:shimmer 1.1s infinite linear; margin-bottom:10px
}
@keyframes shimmer{0%{background-position:100% 0}100%{background-position:-100% 0}}
</style>
</head>
<body>

<!-- Header, search bar, chips, layout ‚Äî all same -->

<div class="header">
  <a href="index.html" class="brand" aria-label="Hiden Spots">
    <svg viewBox="0 0 48 48" aria-hidden="true">
      <circle cx="24" cy="24" r="21" stroke="rgba(255,255,255,0.85)" stroke-width="1.5"/>
      <path d="M24 10 L28 24 L24 38 L20 24 Z" fill="rgba(255,216,155,0.9)"/>
      <circle cx="24" cy="24" r="2.6" fill="#ffffff"/>
    </svg>
    <span>Hiden Spots</span>
  </a>

  <div class="searchbar" id="searchbar">
    <button class="icon-btn" title="Search" aria-label="Search">üîé</button>
    <input id="q" placeholder='Search places, reels, users‚Ä¶ (try "@krishna")'>
    <span class="kbd">/</span>
    <button class="icon-btn" title="Voice" aria-label="Voice">üéôÔ∏è</button>
    <button class="icon-btn" title="Filters" aria-label="Filters" id="openFilters">‚öôÔ∏è</button>
  </div>
</div>

<div class="suggest" id="suggest"></div>

<div class="tools" id="chipsRow">
  <div class="chip active" data-filter="all">All</div>
  <div class="chip" data-filter="new">New</div>
  <div class="chip" data-filter="nearby">Nearby</div>
  <div class="chip" data-filter="Adventure">Adventure</div>
  <div class="chip" data-filter="Spiritual">Spiritual</div>
  <div class="chip" data-filter="Historical">Historical</div>
  <div class="chip" data-filter="Horror">Horror</div>
  <div class="chip" data-filter="Solo">Solo</div>
  <div class="chip" data-filter="Family">Family</div>
  <div class="chip" data-filter="Restaurant">Restaurant</div>
</div>

<div class="powers" id="powers"></div>

<div class="main" id="main">
  <div class="list" id="list">
    <div class="skel"></div><div class="skel"></div><div class="skel"></div>
  </div>

  <div class="map-wrap">
    <div id="realMap" class="map"></div>
    <div class="toast" id="toast">
      <span>Search this area?</span>
      <button id="applyArea">Apply</button>
    </div>
  </div>
</div>
<nav class="nav-bar" aria-label="Primary">
    <a href="Mainhome.html" class="nav-icon" title="Home" aria-label="Home">
      <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </a>
    <a href="Home.html" class="nav-icon" title="Search" aria-label="Search">
      <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    </a>
    <a href="Upload.html" class="nav-icon" title="Create" aria-label="Create">
      <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </a>
    <!-- Destiny List Icon -->
    <a href="Explore.html" class="nav-icon" title="Destiny List" aria-label="Destiny List">
      <svg viewBox="0 0 24 24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
        <circle cx="12" cy="9" r="2.5" fill="none"/>
        <path d="M12 6l.9 1.8 2 .3-1.5 1.5.35 2.1L12 11l-1.75.7.35-2.1-1.5-1.5 2-.3L12 6z" fill="currentColor"/>
      </svg>
    </a>
    <a href="Profile.html" class="nav-icon" title="Profile" aria-label="Profile">
      <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    </a>
  </nav>
<!-- Filters drawer ‚Äî same -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const sb = supabase.createClient(
  "https://bhktkjegansxplpdtack.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJoa3RramVnYW5zeHBscGR0YWNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTE2NjQsImV4cCI6MjA4MTI2NzY2NH0.WlQTPkC6WBjaK_Guy0_XPGahR9oNYsbIHdaBn4WQspE"
);

const WORKER_URL = 'https://hiden-spots-r2-proxy.whynot555x7.workers.dev';

let allSpots = [];
let userMap = new Map();
let leafletMap, leafletMarkers = [];

const q = document.getElementById('q');
const list = document.getElementById('list');

/* ---------- Avatar Helper ---------- */
function getAvatarUrl(username) {
  if (!username) return 'https://ui-avatars.com/api/?name=User&background=FFD88D&color=0c0f18&size=120';
  const r2Avatar = `${WORKER_URL}/file/avatars/${username}-avatar.jpg`;
  const fallback = `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=FFD88D&color=0c0f18&size=120`;
  return r2Avatar;
}

/* ---------- Load Data ---------- */
async function loadData() {
  const { data: spots, error } = await sb
    .from('spots')
    .select('id, name, place, city, story, media_url, media_urls, username, emotion_id, category_id, user_id, created_at, lat, lng')
    .order('created_at', { ascending: false });

  if (error) {
    console.error(error);
    return;
  }

  const categoryNames = {1:'Adventure',2:'Spiritual',3:'Historical',4:'Horror',5:'Solo',6:'Family',7:'Restaurant'};
  const emotionNames = {1:'Peaceful',2:'Long Drive',3:'Romantic',4:'Spiritual',5:'Lonely',6:'Broken',7:'Relaxation',8:'Energetic'};

  allSpots = spots.map(spot => {
    let mediaList = [];
    if (spot.media_urls && Array.isArray(spot.media_urls)) {
      mediaList = spot.media_urls;
    } else if (spot.media_url) {
      mediaList = [{ url: spot.media_url, type: 'image' }];
    }
    const chosen = mediaList[Math.floor(Math.random() * mediaList.length)] || { url: '/placeholder.jpg', type: 'image' };

    return {
      type: 'spot',
      id: spot.id,
      title: spot.name,
      sub: `${spot.place}, ${spot.city}`,
      area: spot.city,
      cat: categoryNames[spot.category_id] || 'Other',
      emotion: emotionNames[spot.emotion_id] || '',
      lat: spot.lat ? parseFloat(spot.lat) : null,
      lng: spot.lng ? parseFloat(spot.lng) : null,
      img: chosen.url,
      user: `@${spot.username || 'traveller'}`,
      username: spot.username || 'traveller',
      avatar: getAvatarUrl(spot.username),
      badge: `${spot.city} ‚Ä¢ ${categoryNames[spot.category_id] || ''}`,
      story: spot.story || 'A beautiful hidden gem shared by the community‚Ä¶'
    };
  });

  // Build user map with counts
  userMap.clear();
  const usernames = [...new Set(spots.map(s => s.username || 'unknown'))];

  for (const username of usernames) {
    const userSpots = spots.filter(s => s.username === username);
    const userId = userSpots.length > 0 ? userSpots[0].user_id : null;

    const { count: followers } = userId ? await sb
      .from('follows')
      .select('*', { count: 'exact', head: true })
      .eq('following_id', userId) : { count: 0 };

    const { count: following } = userId ? await sb
      .from('follows')
      .select('*', { count: 'exact', head: true })
      .eq('follower_id', userId) : { count: 0 };

    userMap.set(username, {
      username,
      avatar: getAvatarUrl(username),
      spotCount: userSpots.length,
      followers: followers || 0,
      following: following || 0
    });
  }

  runSearch();
}

/* ---------- Profile Card ---------- */
async function profileCardHTML(u) {
  return `
  <article class="card profile" data-username="${u.username}">
    <img class="avatar" src="${u.avatar}" alt="@${u.username}"
         onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(u.username)}&background=FFD88D&color=0c0f18&size=120'">
    <div class="info">
      <h3 class="title">@${u.username}</h3>
      <p class="bio">Explorer ‚Ä¢ ${u.spotCount} hidden spots shared</p>
      <div class="stats">
        <div class="stat-item">
          <span class="number">${u.spotCount}</span>
          <span class="label">posts</span>
        </div>
        <div class="stat-item">
          <span class="number">${u.followers}</span>
          <span class="label">followers</span>
        </div>
        <div class="stat-item">
          <span class="number">${u.following}</span>
          <span class="label">following</span>
        </div>
      </div>
    </div>
  </article>`;
}

/* ---------- Spot Cards ---------- */
function detailedCardHTML(p) {
  return `
  <article class="card detailed">
    <div class="media">
      <img src="${p.img}" alt="${p.title}"
           onerror="this.src='https://via.placeholder.com/400x300/141824/FFD88D?text=No+Image'">
      <span class="badge">${p.badge}</span>
    </div>
    <div class="info">
      <h3 class="title">${p.title}</h3>
      <p class="sub">${p.sub}</p>
    </div>
    <div class="meta">
      <div class="mleft">
        <img class="avatar" src="${p.avatar}" alt=""
             onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(p.username)}&background=FFD88D&color=0c0f18&size=120'">
        <span class="username" data-username="${p.username}">${p.user}</span>
      </div>
      <div class="mright">
        <span class="tag">${p.cat}</span>
        <span class="tag">${p.emotion}</span>
      </div>
    </div>
    <div class="story">
      <p>${p.story}</p>
      <a href="spot.html?id=${p.id}">Read more</a>
    </div>
  </article>`;
}

/* ---------- Render ---------- */
async function renderResults(results) {
  if (!results.length) {
    list.innerHTML = `<p style="opacity:.8;text-align:center;padding:60px;">No results. Try "@username" to find a user!</p>`;
    return;
  }

  let html = '';
  for (const item of results) {
    if (item.type === 'profile') {
      html += await profileCardHTML(item);
    } else {
      html += detailedCardHTML(item);
    }
  }
  list.innerHTML = html;
}

/* ---------- Click to Profile ---------- */
list.addEventListener('click', (e) => {
  const profileCard = e.target.closest('.card.profile');
  if (profileCard) {
    const username = profileCard.dataset.username;
    if (username) window.location.href = `Profile.html?user=${username}`;
  }

  const userEl = e.target.closest('.avatar, .username');
  if (userEl && userEl.dataset.username) {
    window.location.href = `Profile.html?user=${userEl.dataset.username}`;
  }
});

/* ---------- Search Logic ---------- */
async function runSearch() {
  const term = q.value.trim().toLowerCase();
  const activeFilter = document.querySelector('.chip.active')?.dataset.filter || 'all';

  let results = allSpots;

  if (activeFilter !== 'all') {
    if (activeFilter === 'new') {
      results = [...allSpots].sort((a, b) => new Date(b.created_at || 0) - new Date(a.created_at || 0));
    } else if (activeFilter === 'nearby') {
      results = [...allSpots].sort(() => 0.5 - Math.random());
    } else {
      results = allSpots.filter(spot => spot.cat === activeFilter);
    }
  }

  if (term) {
    results = results.filter(spot => {
      const text = `${spot.title} ${spot.sub} ${spot.place} ${spot.city} ${spot.cat} ${spot.user}`.toLowerCase();
      return text.includes(term);
    });
  }

  if (term.length >= 2 && !term.includes(' ')) {
    const matchedUsers = Array.from(userMap.values())
      .filter(u => u.username.toLowerCase().includes(term));
    const profileResults = matchedUsers.map(u => ({ type: 'profile', ...u }));
    results = profileResults.concat(results);
  }

  await renderResults(results);

  const spotResults = results.filter(r => r.type !== 'profile');
  plotMarkers(spotResults);
}

/* ---------- Map - FIXED ---------- */
function initLeaflet() {
  leafletMap = L.map('realMap').setView([20.5937, 78.9629], 5); // India center

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(leafletMap);
}

function clearMarkers() {
  leafletMarkers.forEach(m => leafletMap.removeLayer(m));
  leafletMarkers = [];
}

function plotMarkers(arr) {
  clearMarkers();

  const validSpots = arr.filter(p => p.lat !== null && p.lng !== null && !isNaN(p.lat) && !isNaN(p.lng));

  validSpots.forEach(p => {
    const marker = L.marker([p.lat, p.lng])
      .addTo(leafletMap)
      .bindPopup(`
        <strong>${p.title}</strong><br>
        ${p.sub}<br>
        By ${p.user}<br>
        <a href="spot.html?id=${p.id}" style="color:#FFD88D;text-decoration:underline;">View spot ‚Üí</a>
      `);
    leafletMarkers.push(marker);
  });

  // Fit map to pins if available
  if (validSpots.length > 1) {
    const bounds = L.latLngBounds(validSpots.map(p => [p.lat, p.lng]));
    leafletMap.fitBounds(bounds.pad(0.3));
  } else if (validSpots.length === 1) {
    leafletMap.setView([validSpots[0].lat, validSpots[0].lng], 12);
  } else {
    // No pins ‚Üí show India
    leafletMap.setView([20.5937, 78.9629], 5);
  }
}

/* ---------- Init ---------- */
(async () => {
  initLeaflet();
  await loadData();
})();

/* Events */
q.addEventListener('input', runSearch);

document.querySelectorAll('.chip').forEach(chip => {
  chip.addEventListener('click', () => {
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    runSearch();
  });
});
</script>
</body>

</html>




